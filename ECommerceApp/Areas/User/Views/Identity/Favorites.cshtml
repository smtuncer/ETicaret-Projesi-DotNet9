@model IEnumerable<ECommerceApp.Models.Favorite>
@using ECommerceApp.Helper

@{
    ViewData["Title"] = "Favorilerim";
}

<div class="ps-page--my-account bg-light py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-4">
                <partial name="_ProfileSidebar" />
            </div>
            <div class="col-lg-9 col-md-8">
                <div class="card border-0 shadow-sm rounded-3">
                    <div class="card-header bg-white border-bottom-0 pt-4 pb-0 px-4">
                        <h3 class="mb-0 fw-bold text-dark">Favorilerim</h3>
                        <p class="text-muted small mt-1">Favori ürünlerinizi buradan yönetebilirsiniz.</p>
                    </div>
                    <div class="card-body p-4">
                        @if (Model != null && Model.Any())
                        {
                            <div class="row">
                                @foreach (var item in Model)
                                {
                                    var product = item.Product;
                                    var mainImage = product.Images?.FirstOrDefault(i => i.IsMain)?.ImageUrl ?? product.Images?.FirstOrDefault()?.ImageUrl ?? "/images/no-image.jpg";

                                    <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-6 mb-4">
                                        <div class="ps-product border rounded h-100">
                                            <div class="ps-product__thumbnail">
                                                <a href="@Url.ProductUrl(product.Id, product.Name, product.Slug)">
                                                    <img src="@mainImage" alt="@product.Name" loading="lazy" class="img-fluid">
                                                </a>
                                                <div class="ps-product__badge">
                                                </div>
                                                <ul class="ps-product__actions">
                                                    <li><a href="javascript:void(0);" onclick="addToCart(@product.Id, 1)" data-bs-toggle="tooltip" data-placement="top" title="Sepete Ekle"><i class="icon-bag2"></i></a></li>
                                                    <li><a href="@Url.ProductUrl(product.Id, product.Name, product.Slug)" data-bs-toggle="tooltip" data-placement="top" title="İncele"><i class="icon-eye"></i></a></li>
                                                    <li>
                                                        <a href="javascript:void(0);" onclick="toggleFavorite(@product.Id, this)" class="active" data-id="@product.Id" data-bs-toggle="tooltip" data-placement="top" title="Favorilerden Çıkar">
                                                            <i class="icon-heart"></i>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="ps-product__container p-3">
                                                <div class="ps-product__content">
                                                    <a class="ps-product__title d-block mb-2 text-truncate" href="@Url.ProductUrl(product.Id, product.Name, product.Slug)">@product.Name</a>
                                                    <p class="ps-product__price fw-bold mb-0">@product.Price.ToString("N2") ₺</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>

                            @if (ViewBag.TotalPages > 1)
                            {
                                <div class="ps-pagination mt-4">
                                    <ul class="pagination justify-content-center">
                                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                        {
                                            <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                                <a class="page-link" href="/favorilerim?page=@i">@i</a>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="text-center py-5">
                                <i class="icon-heart text-muted display-1 mb-3"></i>
                                <h4 class="text-muted">Favori listenizde henüz ürün yok.</h4>
                                <p class="text-muted mb-4">Beğendiğiniz ürünleri favorilere ekleyerek takip edebilirsiniz.</p>
                                <a href="/" class="btn btn-primary px-4 rounded-pill">Alışverişe Başla</a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .ps-product__actions li a.active i {
        color: #dc3545; /* Kırmızı kalp */
    }
</style>
