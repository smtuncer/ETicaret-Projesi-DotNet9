@model ECommerceApp.Models.Address

@{
    ViewData["Title"] = "Adres Düzenle";
}

<div class="ps-page--my-account bg-light py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-4">
                <partial name="_ProfileSidebar" />
            </div>
            <div class="col-lg-9 col-md-8">
                <div class="card border-0 shadow-sm rounded-3">
                    <div class="card-header bg-white border-bottom-0 pt-4 pb-0 px-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h3 class="mb-0 fw-bold text-dark">Adres Düzenle</h3>
                                <p class="text-muted small mt-1 mb-0">Adres bilgilerinizi güncelleyin.</p>
                            </div>
                            <a href="@Url.Action("Addresses")" class="btn btn-outline-secondary btn-sm rounded-pill">
                                <i class="icon-arrow-left me-1"></i> Geri Dön
                            </a>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        @if (TempData["ErrorMessage"] != null)
                        {
                            <div class="alert alert-danger border-0 shadow-sm mb-4">
                                <i class="icon-warning me-2"></i> @TempData["ErrorMessage"]
                            </div>
                        }

                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                        <form asp-action="UpdateAddress" method="post">
                            <input type="hidden" asp-for="Id" />
                            <input type="hidden" asp-for="UserId" />
                            <input type="hidden" asp-for="CreatedDate" />
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input asp-for="Title" class="form-control" type="text" id="floatingTitle" placeholder="Ev, İş vb." required />
                                        <label for="floatingTitle" class="text-muted">Adres Başlığı (Örn: Ev)</label>
                                        <span asp-validation-for="Title" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input asp-for="FullName" class="form-control" type="text" id="floatingFullName" placeholder="Ad Soyad" required />
                                        <label for="floatingFullName" class="text-muted">Ad Soyad</label>
                                        <span asp-validation-for="FullName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input asp-for="Phone" class="form-control" type="tel" id="floatingPhone" placeholder="Telefon" required />
                                        <label for="floatingPhone" class="text-muted">Telefon</label>
                                        <span asp-validation-for="Phone" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input asp-for="Country" class="form-control" type="text" id="floatingCountry" placeholder="Ülke" required />
                                        <label for="floatingCountry" class="text-muted">Ülke</label>
                                        <span asp-validation-for="Country" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input asp-for="City" class="form-control" type="text" id="floatingCity" placeholder="Şehir" required />
                                        <label for="floatingCity" class="text-muted">Şehir</label>
                                        <span asp-validation-for="City" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input asp-for="District" class="form-control" type="text" id="floatingDistrict" placeholder="İlçe" required />
                                        <label for="floatingDistrict" class="text-muted">İlçe</label>
                                        <span asp-validation-for="District" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input asp-for="ZipCode" class="form-control" type="text" id="floatingZip" placeholder="Posta Kodu" />
                                        <label for="floatingZip" class="text-muted">Posta Kodu</label>
                                        <span asp-validation-for="ZipCode" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-floating">
                                        <textarea asp-for="OpenAddress" class="form-control" id="floatingAddress" rows="3" placeholder="Açık Adres" style="height: 100px" required></textarea>
                                        <label for="floatingAddress" class="text-muted">Açık Adres</label>
                                        <span asp-validation-for="OpenAddress" class="text-danger"></span>
                                    </div>
                                </div>

                                <!-- Fatura Adresi Checkbox -->
                                <div class="col-12">
                                    <div class="form-check">
                                        <input asp-for="IsBillingAddress" class="form-check-input" type="checkbox" id="isBillingAddress" onchange="toggleBillingFields()">
                                        <label class="form-check-label fw-bold" for="isBillingAddress">
                                            Bu adres fatura adresi olarak kullanılacak
                                        </label>
                                    </div>
                                </div>

                                <!-- Fatura Bilgileri (Conditional) -->
                                <div id="billingFields" style="display: @(Model.IsBillingAddress ? "block" : "none");" class="col-12">
                                    <div class="card bg-light border-0 mt-2">
                                        <div class="card-body">
                                            <h6 class="fw-bold mb-3">Fatura Bilgileri</h6>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input asp-for="IdentityNumber" class="form-control" type="text" id="floatingIdentityNumber" placeholder="TC Kimlik No" maxlength="11" />
                                                        <label for="floatingIdentityNumber" class="text-muted">TC Kimlik No</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input asp-for="CompanyName" class="form-control" type="text" id="floatingCompanyName" placeholder="Şirket Adı (Opsiyonel)" />
                                                        <label for="floatingCompanyName" class="text-muted">Şirket Adı (Kurumsal için)</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input asp-for="TaxOffice" class="form-control" type="text" id="floatingTaxOffice" placeholder="Vergi Dairesi" />
                                                        <label for="floatingTaxOffice" class="text-muted">Vergi Dairesi</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input asp-for="TaxNumber" class="form-control" type="text" id="floatingTaxNumber" placeholder="Vergi No" />
                                                        <label for="floatingTaxNumber" class="text-muted">Vergi No</label>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-floating">
                                                        <textarea asp-for="BillingAddress" class="form-control" id="floatingBillingAddress" rows="2" placeholder="Fatura Adresi" style="height: 80px"></textarea>
                                                        <label for="floatingBillingAddress" class="text-muted">Fatura Adresi (Teslimat adresinden farklıysa)</label>
                                                        <span asp-validation-for="BillingAddress" class="text-danger"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 d-flex justify-content-end gap-2">
                                <a href="@Url.Action("Addresses")" class="btn btn-outline-secondary btn-lg px-4 rounded-pill">İptal</a>
                                <button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill fw-bold shadow-sm">Değişiklikleri Kaydet</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleBillingFields() {
        const checkbox = document.getElementById('isBillingAddress');
        const billingFields = document.getElementById('billingFields');
        
        if (checkbox.checked) {
            billingFields.style.display = 'block';
        } else {
            billingFields.style.display = 'none';
        }
    }
</script>

<style>
    .form-floating > .form-control {
        border: 1px solid #eee;
        border-radius: 10px;
        height: 58px; /* Fixed height for proper label positioning */
        line-height: 1.25;
    }
    
    .form-floating > label {
        padding: 1rem 0.75rem;
    }
    
    .form-floating > .form-control:focus {
        border-color: #C5A059;
        box-shadow: 0 0 0 0.25rem rgba(252, 184, 0, 0.15);
    }
    
    .btn-primary {
        background-color: #C5A059;
        border-color: #C5A059;
    }
    .btn-primary:hover {
        background-color: #b08f4a;
        border-color: #b08f4a;
    }
</style>
